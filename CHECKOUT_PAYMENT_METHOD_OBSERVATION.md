# Paddle Checkout 支付方式联调现象汇报

## 1. 汇报目标

记录本次在 Paddle Sandbox 环境中联调 Checkout 时，关于「订阅模式下切换国家/币种，支付方式不变化」的现象、排查过程与结论。

## 2. 测试环境

- 平台：Paddle Sandbox（Test mode）
- 结账方式：
  - Hosted Checkout URL（`sandbox-pay.paddle.io/hsc_...`）
  - 本地 HTML 页面 + Paddle.js（`Paddle.Checkout.open`）
- 商品类型：
  - 订阅价格（Monthly）
  - 一次性价格（One-time）
- 已启用支付方式：后台已开启多种方式（含卡、PayPal、WeChat Pay 等）

## 3. 关键现象

### 3.1 订阅场景

- 在订阅价格下，即使切换国家与本地币种，Checkout 页面支付方式基本保持不变（常见为卡 + PayPal）。
- 未出现预期的更多本地支付方式切换。

### 3.2 一次性场景

- 切换为一次性价格后，在特定国家/币种组合下可出现本地支付方式（例如 WeChat Pay）。
- 说明「国家 + 币种」确实会影响支付方式，但影响程度与交易类型强相关。

## 4. 排查与验证过程

1. 验证 token 与 price 环境一致（`test_...` 与 `pri_...` 均来自 Sandbox）。
2. 验证 Hosted Checkout 可正常打开并可完成支付页加载。
3. 验证本地 HTML 方案曾出现 `Failed to retrieve JWT`，后确认与后台默认付款链接配置相关。
4. 在同一账号下对比订阅价与一次性价的支付方式展示差异。

## 5. 结论

- 「后台勾选全部支付方式」不等于前台一定全部展示。
- Checkout 实际展示的支付方式由多因素动态决定：
  - 交易类型（订阅/一次性）
  - 国家/地区
  - 币种
  - 设备与浏览器能力
  - Paddle 风控与实时可用性
- 本次现象属于预期平台行为：订阅场景下可用支付方式集合更窄，切换国家/币种不一定触发方式变化。

## 6. 对业务的影响

- 若业务目标是最大化本地支付方式覆盖，不能只依赖订阅价格单一路径验证。
- 需要分别设计订阅与一次性的支付方式验证矩阵，否则会产生“已启用但前台不显示”的误判。

## 7. 后续建议

1. 建立支付方式测试矩阵（交易类型 × 国家 × 币种 × 设备）。
2. 对重点市场（如 CN、KR、EU）分别验证一次性与订阅。
3. 若产品允许，可对特定国家增加一次性方案以覆盖更多本地支付方式。
4. 上线前使用 Hosted Checkout 做稳定性兜底，同时保留 Paddle.js 方案做体验增强。

## 8. 当前状态

- 现象已复现并确认。
- 已具备可演示的成功链路（Hosted Checkout）。
- 订阅场景“切国家/币种不切支付方式”判定为规则与可用性驱动的正常结果。
